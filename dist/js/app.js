function initialize(){var o={zoom:14,center:new google.maps.LatLng(48.77385,9.176832),disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("map-canvas"),o)}var config={foursquare:{URL:"https://api.foursquare.com/v2/venues/search",CLIENT_ID:"C0J5BP55MVKSIO5LDPV3DTZQFG0OH3TZCJPZL4C3KLMROETC",CLIENT_SECRET:"IM21TX0DTYM5DZ4ABJ2VABJUJR5U3NVKLGZVSJZMPWQQFM3J",API_VERSION:20130815}},Location=function(o){var e=this;e.name=ko.observable(o.name),e.lat=ko.observable(o.lat),e.lon=ko.observable(o.lon),e.address=ko.observable(o.address),e.checkins=ko.observable(o.checkins),e.hearts=ko.observable(o.hearts),e.marker=new google.maps.Marker({position:new google.maps.LatLng(o.lat,o.lon),map:map,title:o.name,animation:google.maps.Animation.DROP}),e.loved=ko.computed(function(){return e.hearts()>5}),e.focused=ko.observable(!1),e.setFocused=function(){e.focused(!0),infowindow.setContent(e.name()),infowindow.open(map,e.marker)},google.maps.event.addListener(e.marker,"click",function(){e.setFocused()})},MapSearch=function(){var o=this;o.searchString=ko.observable(),o.loading=ko.observable(!1),o.search=function(){o.clearLocations(),o.searchString()&&(o.loading(!0),$.ajax({dataType:"json",url:config.foursquare.URL,data:{client_id:config.foursquare.CLIENT_ID,client_secret:config.foursquare.CLIENT_SECRET,v:config.foursquare.API_VERSION,ll:map.getCenter().toUrlValue(),query:o.searchString()}}).then(function(e){if(o.loading(!1),e&&e.response&&e.response.venues){for(var n=e.response.venues,a=n.length,t=0;a>t;t++){var r=n[t],e={name:r.name,lat:r.location.lat,lon:r.location.lng,address:r.location.formattedAddress[0],checkins:r.stats.checkinsCount,hearts:r.stats.tipCount};e.checkins&&e.hearts&&o.locations.push(new Location(e))}$("#filter-input").focus()}},function(o){console.error(o),alert("my bad...")}))},o.locations=ko.observableArray([]),o.locationsCount=ko.computed(function(){return o.locations().length}),o.clearLocations=function(){for(var e=o.locations(),n=e.length,a=0;n>a;a++)e[a].marker.setMap(null);o.locations([])},o.clearLocationFocus=function(){for(var e=o.locations(),n=e.length,a=0;n>a;a++)e[a].focused(!1)},o.focusLocation=function(e){o.clearLocationFocus(),e.setFocused(),e.marker.setAnimation(google.maps.Animation.DROP),map.panTo(e.marker.getPosition())},o.listActive=ko.computed(function(){return o.locations().length>0}),o.filterString=ko.observable(),o.filteredLocations=ko.computed(function(){var e=o.filterString()||"";return o.locations().filter(function(o){var n=o.name().toLowerCase().indexOf(e.toLowerCase())>-1;return o.marker.setMap(n?map:null),n})}),o.filteredLocationsCount=ko.computed(function(){return o.filteredLocations().length}),o.newSearch=function(){o.clearLocations(),o.searchString(""),$("#search-input").focus()}},map,infowindow=new google.maps.InfoWindow;google.maps.event.addDomListener(window,"load",initialize),ko.applyBindings(new MapSearch);