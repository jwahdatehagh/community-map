function initialize(){var e={zoom:14,center:new google.maps.LatLng(48.77385,9.176832),disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("map-canvas"),e)}function initialize(){var e={zoom:14,center:new google.maps.LatLng(48.77385,9.176832),disableDefaultUI:!0};map=new google.maps.Map(document.getElementById("map-canvas"),e)}var map;google.maps.event.addDomListener(window,"load",initialize);var config={foursquare:{URL:"https://api.foursquare.com/v2/venues/search",CLIENT_ID:"C0J5BP55MVKSIO5LDPV3DTZQFG0OH3TZCJPZL4C3KLMROETC",CLIENT_SECRET:"IM21TX0DTYM5DZ4ABJ2VABJUJR5U3NVKLGZVSJZMPWQQFM3J",API_VERSION:20130815}},map;google.maps.event.addDomListener(window,"load",initialize);var Location=function(e){var a=this;a.name=ko.observable(e.name),a.lat=ko.observable(e.lat),a.lon=ko.observable(e.lon),a.address=ko.observable(e.address),a.checkins=ko.observable(e.checkins),a.hearts=ko.observable(e.hearts),a.marker=new google.maps.Marker({position:new google.maps.LatLng(e.lat,e.lon),map:map,title:e.name}),a.loved=ko.computed(function(){return a.hearts()>5})},MapSearch=function(){var e=this;e.searchString=ko.observable(),e.loading=ko.observable(!1),e.search=function(){e.clearLocations(),e.searchString()&&(e.loading(!0),$.ajax({dataType:"json",url:config.foursquare.URL,data:{client_id:config.foursquare.CLIENT_ID,client_secret:config.foursquare.CLIENT_SECRET,v:config.foursquare.API_VERSION,ll:map.getCenter().toUrlValue(),query:e.searchString()}}).then(function(a){if(e.loading(!1),a&&a.response&&a.response.venues)for(var o=a.response.venues,n=o.length,t=0;n>t;t++){var s=o[t],a={name:s.name,lat:s.location.lat,lon:s.location.lng,address:s.location.formattedAddress[0],checkins:s.stats.checkinsCount,hearts:s.stats.tipCount};a.checkins&&a.hearts&&e.locations.push(new Location(a))}},function(e){alert("my bad...")}),console.log("searching for "+e.searchString()))},e.locations=ko.observableArray([]),e.locationsCount=ko.computed(function(){return e.locations().length}),e.clearLocations=function(){for(var a=e.locations(),o=a.length,n=0;o>n;n++)a[n].marker.setMap(null);e.locations([])},e.listActive=ko.computed(function(){return e.locations().length>0})};ko.applyBindings(new MapSearch);